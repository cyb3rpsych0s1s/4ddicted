# 2023-02-12

## Research on mimicking Berserk effect

Creating and modifiying stats modifiers.

credits to Perks Overhaul

```lua
function scaleToPlayerLevel(itemData)
    if not ItemID.IsValid(itemData:GetID()) or not playerDevSystem:IsTraitUnlocked(gamedataTraitType.CraftingTrait01) then
        return
    end

    local itemID = itemData:GetID();
    
    if itemData ~= nil then
        if categorys[RPGManager.GetItemCategory(itemID).value] then
            if ItemID.GetStructure(itemID) == gamedataItemStructure.Unique then
                if not RPGManager.IsItemSingleInstance(itemData) and Game.GetStatsSystem():GetStatValue(itemData:GetStatsObjectID(), gamedataStatType.PowerLevel) < Game.GetStatsSystem():GetStatValue(Game.GetPlayer():GetEntityID(), gamedataStatType.PowerLevel) then
                    local SS = Game.GetStatsSystem()
                    local PEntity = Game.GetPlayer():GetEntityID()
                    local pLvl = SS:GetStatValue(PEntity, gamedataStatType.PowerLevel)
                    local wasItemUpgraded = SS:GetStatValue(PEntity, gamedataStatType.WasItemUpgraded) > 0
                    local wasItemUpgradedModifier
                    if not wasItemUpgraded and Game.GetScriptableSystemsContainer():Get("CraftingSystem"):CanItemBeUpgraded(itemData) then
                        wasItemUpgradedModifier = RPGManager.CreateStatModifier(gamedataStatType.WasItemUpgraded, gameStatModifierType.Additive, 1)
                        SS:AddSavedModifier(itemData:GetStatsObjectID(), wasItemUpgradedModifier)
                    end
                    local craftingLevelBoost = Game.GetScriptableSystemsContainer():Get(CName.new("CraftingSystem")):CalculateCraftingLevelBoost()
                    SS:RemoveAllModifiers(itemData:GetStatsObjectID(), gamedataStatType.PowerLevel, true)
                    SS:AddSavedModifier(itemData:GetStatsObjectID(), RPGManager.CreateStatModifier(gamedataStatType.PowerLevel, gameStatModifierType.Additive, pLvl))
                    SS:RemoveAllModifiers(itemData:GetStatsObjectID(), gamedataStatType.ItemLevel, true)
                    SS:AddSavedModifier(itemData:GetStatsObjectID(), RPGManager.CreateStatModifier(gamedataStatType.ItemLevel, gameStatModifierType.Additive, (pLvl * (10 - craftingLevelBoost))))
                    local combinedStat = RPGManager.CreateCombinedStatModifier(gamedataStatType.ItemLevel, gameStatModifierType.Additive, gamedataStatType.WasItemUpgraded, gameCombinedStatOperation.Multiplication, 10, gameStatObjectsRelation.Self)
                    SS:AddSavedModifier(itemData:GetStatsObjectID(), combinedStat)

                    print("Crazy Science: Upgraded item: " .. Game.GetLocalizedTextByKey(TweakDB:GetRecord(itemID.id):DisplayName()))
                end
            end
        end
    end
end
```
